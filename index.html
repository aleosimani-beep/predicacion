<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Predicaci√≥n</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        window.storage = {
            get: async (key) => {
                const value = localStorage.getItem(key);
                return value ? { key, value } : null;
            },
            set: async (key, value) => {
                localStorage.setItem(key, value);
                return { key, value };
            }
        };

        const App = () => {
            const [tab, setTab] = useState('inicio');
            const [menu, setMenu] = useState(false);
            const [informes, setInformes] = useState([]);
            const [salidas, setSalidas] = useState([]);
            const [interesados, setInteresados] = useState([]);
            const [territorio, setTerritorio] = useState(null);
            const [metaAnual, setMetaAnual] = useState(0);
            const [metaMensual, setMetaMensual] = useState(0);
            const [nombre, setNombre] = useState('');
            const [foto, setFoto] = useState(null);
            const [editPerfil, setEditPerfil] = useState(false);
            const [agenda, setAgenda] = useState([]);

            useEffect(() => {
                (async () => {
                    const [inf, sal, int, ter, met, per, age] = await Promise.all([
                        window.storage.get('informes').catch(() => null),
                        window.storage.get('salidas').catch(() => null),
                        window.storage.get('interesados').catch(() => null),
                        window.storage.get('territorio').catch(() => null),
                        window.storage.get('metas').catch(() => null),
                        window.storage.get('perfil').catch(() => null),
                        window.storage.get('agenda').catch(() => null)
                    ]);
                    if (inf?.value) setInformes(JSON.parse(inf.value));
                    if (sal?.value) setSalidas(JSON.parse(sal.value));
                    if (int?.value) setInteresados(JSON.parse(int.value));
                    if (ter?.value) setTerritorio(ter.value);
                    if (met?.value) {
                        const m = JSON.parse(met.value);
                        setMetaAnual(m.anual || 0);
                        setMetaMensual(m.mensual || 0);
                    }
                    if (per?.value) {
                        const p = JSON.parse(per.value);
                        setNombre(p.nombre || '');
                        setFoto(p.foto || null);
                    }
                    if (age?.value) setAgenda(JSON.parse(age.value));
                })();
            }, []);

            const saveInformes = async (data) => {
                setInformes(data);
                await window.storage.set('informes', JSON.stringify(data));
            };

            const saveSalidas = async (data) => {
                setSalidas(data);
                await window.storage.set('salidas', JSON.stringify(data));
            };

            const saveInteresados = async (data) => {
                setInteresados(data);
                await window.storage.set('interesados', JSON.stringify(data));
            };

            const saveTerritorio = async (data) => {
                setTerritorio(data);
                await window.storage.set('territorio', data);
            };

            const saveMetas = async (anual, mensual) => {
                setMetaAnual(anual);
                setMetaMensual(mensual);
                await window.storage.set('metas', JSON.stringify({ anual, mensual }));
            };

            const savePerfil = async (n, f) => {
                setNombre(n);
                setFoto(f);
                await window.storage.set('perfil', JSON.stringify({ nombre: n, foto: f }));
            };

            const saveAgenda = async (data) => {
                setAgenda(data);
                await window.storage.set('agenda', JSON.stringify(data));
            };

            const Inicio = ({ nombre, foto, salidas, informes, interesados, metaMensual, setTab, editPerfil, setEditPerfil, savePerfil }) => {
                const [tempNombre, setTempNombre] = useState(nombre);
                const [tempFoto, setTempFoto] = useState(foto);
                
                useEffect(() => {
                    setTempNombre(nombre);
                    setTempFoto(foto);
                }, [nombre, foto, editPerfil]);

                const hoy = new Date();
                const hora = hoy.getHours();
                const esMa√±ana = hora < 14;
                
                const salidaHoy = salidas.find(s => {
                    const f = new Date(s.fecha + 'T00:00:00');
                    return f.toDateString() === hoy.toDateString() && s.turno === (esMa√±ana ? 'ma√±ana' : 'tarde');
                });

                const horasMes = informes
                    .filter(i => i.fecha.startsWith(hoy.toISOString().slice(0, 7)))
                    .reduce((t, i) => t + i.horas, 0);

                const restantes = metaMensual - horasMes;
                const diasRestantes = (() => {
                    const ultimoDia = new Date(hoy.getFullYear(), hoy.getMonth() + 1, 0);
                    return ultimoDia.getDate() - hoy.getDate() + 1;
                })();
                const horasPorDia = diasRestantes > 0 ? (restantes / diasRestantes) : 0;

                const semana = (() => {
                    const dia = hoy.getDay();
                    const dif = (dia + 4) % 7;
                    const mier = new Date(hoy);
                    mier.setDate(hoy.getDate() - dif);
                    return Array.from({ length: 7 }, (_, i) => {
                        const d = new Date(mier);
                        d.setDate(mier.getDate() + i);
                        return d;
                    });
                })();

                const visitas = interesados
                    .filter(i => i.fecha && new Date(i.fecha + 'T00:00:00') >= hoy)
                    .sort((a, b) => new Date(a.fecha) - new Date(b.fecha))
                    .slice(0, 3);

                const saludo = hora < 12 ? 'Buenos d√≠as' : hora < 19 ? 'Buenas tardes' : 'Buenas noches';

                const handleFoto = (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (ev) => {
                            setTempFoto(ev.target.result);
                        };
                        reader.readAsDataURL(file);
                    }
                };

                const guardarPerfil = () => {
                    savePerfil(tempNombre, tempFoto);
                    setEditPerfil(false);
                };

                return (
                    <div className="p-6">
                        <div className="bg-gradient-to-r from-blue-500 to-blue-600 rounded-lg p-6 text-white mb-6 shadow-lg">
                            <div className="flex items-center gap-4 mb-3">
                                <div className="relative">
                                    {foto ? (
                                        <img src={foto} alt="Perfil" className="w-16 h-16 rounded-full object-cover border-2 border-white" />
                                    ) : (
                                        <div className="w-16 h-16 rounded-full bg-blue-400 flex items-center justify-center text-2xl font-bold">
                                            {nombre ? nombre[0].toUpperCase() : 'üë§'}
                                        </div>
                                    )}
                                    <button onClick={() => setEditPerfil(true)} className="absolute -bottom-1 -right-1 bg-white text-blue-600 rounded-full p-1 text-xs">
                                        üì∑
                                    </button>
                                </div>
                                <div>
                                    <h2 className="text-2xl font-bold">
                                        {saludo}{nombre ? `, ${nombre}` : ''}! üëã
                                    </h2>
                                    <p className="text-blue-100 capitalize">
                                        {hoy.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}
                                    </p>
                                </div>
                            </div>

                            <div className="bg-white/20 rounded-lg p-4 mt-4">
                                <div className="flex items-center justify-between mb-2">
                                    <span className="text-sm text-blue-100">Este mes</span>
                                    <span>üìà</span>
                                </div>
                                <div className="flex items-baseline gap-2">
                                    <span className="text-3xl font-bold">{horasMes.toFixed(1)}</span>
                                    <span className="text-lg">/ {metaMensual} hrs</span>
                                </div>
                                <div className="mt-2">
                                    <div className="w-full bg-blue-700 rounded-full h-2">
                                        <div className="bg-white h-2 rounded-full" style={{ width: `${Math.min((horasMes / metaMensual) * 100, 100)}%` }}></div>
                                    </div>
                                    <div className="mt-2 space-y-1">
                                        <p className="text-sm text-blue-100">
                                            {restantes > 0 ? `Te faltan ${restantes.toFixed(1)} hrs` : '¬°Meta alcanzada! üéâ'}
                                        </p>
                                        {restantes > 0 && diasRestantes > 0 && (
                                            <p className="text-sm text-blue-100">
                                                üìÖ Necesitas {horasPorDia.toFixed(1)} hrs/d√≠a para llegar
                                            </p>
                                        )}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {salidaHoy ? (
                            <div className="bg-white rounded-lg p-5 shadow-md mb-4">
                                <h3 className="text-lg font-bold text-gray-800 mb-3">
                                    üöó Salida de Hoy ({salidaHoy.turno === 'ma√±ana' ? 'Ma√±ana' : 'Tarde'})
                                </h3>
                                <div className="space-y-2 text-gray-700">
                                    <p className="font-semibold text-xl text-blue-600">{salidaHoy.hora}</p>
                                    <p>üìç {salidaHoy.lugar}</p>
                                    <p>üë§ Conductor: {salidaHoy.conductor}</p>
                                    <p>üìñ Mapa {salidaHoy.mapa}</p>
                                </div>
                            </div>
                        ) : (
                            <div className="bg-gray-50 rounded-lg p-5 text-center mb-4">
                                <p className="text-gray-600">‚è∞ No hay salida programada para hoy</p>
                            </div>
                        )}

                        <div className="bg-white rounded-lg p-5 shadow-md mb-4">
                            <h3 className="text-lg font-bold text-gray-800 mb-3">üìÖ Esta Semana</h3>
                            <div className="space-y-2">
                                {semana.map((f, i) => {
                                    const fs = f.toISOString().split('T')[0];
                                    const sm = salidas.find(s => s.fecha === fs && s.turno === 'ma√±ana');
                                    const st = salidas.find(s => s.fecha === fs && s.turno === 'tarde');
                                    const esHoy = f.toDateString() === hoy.toDateString();

                                    return (
                                        <div key={i} className={`flex items-center justify-between p-2 rounded ${esHoy ? 'bg-blue-50' : ''}`}>
                                            <span className={`font-semibold ${esHoy ? 'text-blue-600' : 'text-gray-700'}`}>
                                                {f.toLocaleDateString('es-ES', { weekday: 'short', day: 'numeric' }).replace('.', '')}
                                                {esHoy && ' (Hoy)'}
                                            </span>
                                            <div className="flex gap-2">
                                                <span className={`px-2 py-1 rounded text-xs ${sm ? 'bg-yellow-100 text-yellow-700' : 'bg-gray-100 text-gray-400'}`}>
                                                    ‚òÄÔ∏è {sm ? '‚úì' : '‚úó'}
                                                </span>
                                                <span className={`px-2 py-1 rounded text-xs ${st ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-400'}`}>
                                                    üåô {st ? '‚úì' : '‚úó'}
                                                </span>
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>

                        {visitas.length > 0 && (
                            <div className="bg-white rounded-lg p-5 shadow-md mb-4">
                                <h3 className="text-lg font-bold text-gray-800 mb-3">üë• Pr√≥ximas Visitas</h3>
                                <div className="space-y-3">
                                    {visitas.map(v => (
                                        <div key={v.id} className="flex items-center justify-between p-3 bg-purple-50 rounded-lg">
                                            <div>
                                                <p className="font-semibold text-gray-800">{v.nombre}</p>
                                                <p className="text-sm text-gray-600">
                                                    {new Date(v.fecha + 'T00:00:00').toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'short' })}
                                                    {v.horaPreferente && ` - ${v.horaPreferente}`}
                                                </p>
                                            </div>
                                            <span>üìç</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        <div className="grid grid-cols-2 gap-4">
                            <button onClick={() => setTab('registro-rapido')} className="bg-green-500 text-white p-4 rounded-lg shadow-md hover:bg-green-600">
                                <div className="text-2xl mb-2">‚è±Ô∏è</div>
                                <span className="text-sm font-semibold">Registrar Horas</span>
                            </button>
                            <button onClick={() => setTab('interesados')} className="bg-purple-500 text-white p-4 rounded-lg shadow-md hover:bg-purple-600">
                                <div className="text-2xl mb-2">‚ûï</div>
                                <span className="text-sm font-semibold">Nuevo Interesado</span>
                            </button>
                        </div>

                        {editPerfil && (
                            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                                <div className="bg-white rounded-lg p-6 w-full max-w-sm">
                                    <h3 className="text-xl font-bold mb-4">Editar Perfil</h3>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block font-semibold mb-2">Nombre</label>
                                            <input
                                                type="text"
                                                value={tempNombre}
                                                onChange={(e) => setTempNombre(e.target.value)}
                                                className="w-full p-3 border rounded-lg"
                                                placeholder="Tu nombre"
                                            />
                                        </div>
                                        <div>
                                            <label className="block font-semibold mb-2">Foto de Perfil</label>
                                            {tempFoto && (
                                                <div className="mb-2 text-center">
                                                    <img src={tempFoto} alt="Vista previa" className="w-20 h-20 rounded-full mx-auto object-cover" />
                                                </div>
                                            )}
                                            <input type="file" accept="image/*" onChange={handleFoto} className="hidden" id="foto-perfil" />
                                            <label htmlFor="foto-perfil" className="block w-full p-3 border-2 border-dashed rounded-lg text-center cursor-pointer hover:bg-gray-50">
                                                {tempFoto ? 'Cambiar Foto' : 'Seleccionar Foto'}
                                            </label>
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={guardarPerfil}
                                                className="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600"
                                            >
                                                Guardar
                                            </button>
                                            <button onClick={() => setEditPerfil(false)} className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400">
                                                Cancelar
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            };

            const RegistroRapido = ({ informes, saveInformes, setTab }) => {
                const hoy = new Date().toISOString().split('T')[0];
                const inf = informes.find(i => i.fecha === hoy);
                const [horas, setHoras] = useState(inf?.horas || 0);
                const [cursos, setCursos] = useState(inf?.cursos || '');

                const guardar = () => {
                    const nuevo = informes.filter(i => i.fecha !== hoy);
                    if (horas > 0 || cursos) {
                        nuevo.push({ fecha: hoy, horas: parseFloat(horas), cursos: parseInt(cursos) || 0 });
                    }
                    saveInformes(nuevo);
                    alert('¬°Horas registradas!');
                    setTab('inicio');
                };

                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold mb-6">Registrar Horas de Hoy</h2>
                        <div className="bg-white rounded-lg p-6 shadow-md">
                            <p className="text-center text-gray-600 mb-6">
                                {new Date().toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}
                            </p>
                            <div className="mb-6">
                                <label className="block font-semibold mb-3 text-center">Horas</label>
                                <div className="flex items-center gap-4">
                                    <button onClick={() => setHoras(Math.max(0, horas - 0.5))} className="bg-red-500 text-white w-16 h-16 rounded-full text-3xl hover:bg-red-600">
                                        ‚àí
                                    </button>
                                    <div className="flex-1 text-center">
                                        <span className="text-6xl font-bold">{horas.toFixed(1)}</span>
                                        <p className="text-gray-500 text-lg mt-2">horas</p>
                                    </div>
                                    <button onClick={() => setHoras(horas + 0.5)} className="bg-green-500 text-white w-16 h-16 rounded-full text-3xl hover:bg-green-600">
                                        +
                                    </button>
                                </div>
                            </div>
                            <div className="mb-6">
                                <label className="block font-semibold mb-2">Cursos B√≠blicos (opcional)</label>
                                <input
                                    type="number"
                                    value={cursos}
                                    onChange={(e) => setCursos(e.target.value)}
                                    className="w-full p-3 border rounded-lg text-center text-2xl"
                                    placeholder="0"
                                />
                            </div>
                            <div className="flex gap-3">
                                <button onClick={guardar} className="flex-1 bg-blue-500 text-white py-4 rounded-lg hover:bg-blue-600 text-lg font-semibold">
                                    üíæ Guardar
                                </button>
                                <button onClick={() => setTab('inicio')} className="flex-1 bg-gray-300 text-gray-700 py-4 rounded-lg hover:bg-gray-400 text-lg font-semibold">
                                    Cancelar
                                </button>
                            </div>
                        </div>
                    </div>
                );
            };
const Informe = ({ informes, saveInformes, metaAnual, metaMensual, saveMetas }) => {
                const [mes, setMes] = useState(new Date().toISOString().slice(0, 7));
                const [dia, setDia] = useState(new Date().getDate());
                const [horas, setHoras] = useState(0);
                const [cursos, setCursos] = useState('');
                const [editMetas, setEditMetas] = useState(false);
                const [tempAnual, setTempAnual] = useState(metaAnual);
                const [tempMensual, setTempMensual] = useState(metaMensual);
                const [verHistorial, setVerHistorial] = useState(false);

                const fecha = `${mes}-${String(dia).padStart(2, '0')}`;
                const inf = informes.find(i => i.fecha === fecha);

                useEffect(() => {
                    if (inf) {
                        setHoras(inf.horas);
                        setCursos(inf.cursos);
                    } else {
                        setHoras(0);
                        setCursos('');
                    }
                }, [dia, mes]);

                const guardar = () => {
                    const nuevo = informes.filter(i => i.fecha !== fecha);
                    if (horas > 0 || cursos) {
                        nuevo.push({ fecha, horas: parseFloat(horas), cursos: parseInt(cursos) || 0 });
                    }
                    saveInformes(nuevo);
                    alert('Informe guardado');
                };

                const horasAnio = (() => {
                    const hoy = new Date();
                    const m = hoy.getMonth();
                    const a = hoy.getFullYear();
                    const inicio = m >= 8 ? new Date(a, 8, 1) : new Date(a - 1, 8, 1);
                    const fin = m >= 8 ? new Date(a + 1, 7, 31) : new Date(a, 7, 31);
                    return informes.filter(i => {
                        const f = new Date(i.fecha + 'T00:00:00');
                        return f >= inicio && f <= fin;
                    }).reduce((t, i) => t + i.horas, 0);
                })();

                const horasMes = informes.filter(i => i.fecha.startsWith(mes)).reduce((t, i) => t + i.horas, 0);
                const diasMes = new Date(mes.split('-')[0], mes.split('-')[1], 0).getDate();

                const mesesConActividad = (() => {
                    const meses = {};
                    informes.forEach(i => {
                        const m = i.fecha.slice(0, 7);
                        if (!meses[m]) meses[m] = { horas: 0, cursos: 0 };
                        meses[m].horas += i.horas;
                        meses[m].cursos += i.cursos;
                    });
                    return Object.keys(meses).sort().reverse().map(m => ({
                        mes: m,
                        nombre: new Date(m + '-15').toLocaleDateString('es-ES', { month: 'long', year: 'numeric' }),
                        ...meses[m]
                    }));
                })();

                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold mb-6">Mi Informe de Actividad</h2>
                        <div className="mb-4">
                            <button onClick={() => setVerHistorial(!verHistorial)} className="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-semibold">
                                {verHistorial ? 'üìù Volver a Registrar' : 'üìä Ver Historial de Meses'}
                            </button>
                        </div>
                        {verHistorial ? (
                            <div className="space-y-3">
                                {mesesConActividad.length === 0 ? (
                                    <div className="bg-gray-50 rounded-lg p-8 text-center"><p className="text-gray-600">No hay informes registrados</p></div>
                                ) : (
                                    mesesConActividad.map((m, i) => (
                                        <div key={i} className="bg-white rounded-lg p-5 shadow-md">
                                            <h3 className="font-bold text-lg text-gray-800 capitalize mb-2">{m.nombre}</h3>
                                            <div className="grid grid-cols-2 gap-4 text-center">
                                                <div className="bg-blue-50 rounded-lg p-3">
                                                    <p className="text-2xl font-bold text-blue-600">{m.horas.toFixed(1)}</p>
                                                    <p className="text-sm text-gray-600">Horas</p>
                                                </div>
                                                <div className="bg-green-50 rounded-lg p-3">
                                                    <p className="text-2xl font-bold text-green-600">{m.cursos}</p>
                                                    <p className="text-sm text-gray-600">Cursos</p>
                                                </div>
                                            </div>
                                            <button onClick={() => { setMes(m.mes); setDia(1); setVerHistorial(false); }} className="w-full mt-3 bg-gray-200 text-gray-700 py-2 rounded-lg hover:bg-gray-300">
                                                Ver detalles
                                            </button>
                                        </div>
                                    ))
                                )}
                            </div>
                        ) : (
                            <>
                                <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                                    <label className="block font-semibold mb-2">Mes</label>
                                    <input type="month" value={mes} onChange={(e) => { setMes(e.target.value); setDia(1); }} className="w-full p-3 border rounded-lg mb-4" />
                                    <label className="block font-semibold mb-2">D√≠a</label>
                                    <select value={dia} onChange={(e) => setDia(parseInt(e.target.value))} className="w-full p-3 border rounded-lg mb-4">
                                        {Array.from({ length: diasMes }, (_, i) => (
                                            <option key={i + 1} value={i + 1}>
                                                {i + 1} - {new Date(mes + `-${String(i + 1).padStart(2, '0')}`).toLocaleDateString('es-ES', { weekday: 'long' })}
                                            </option>
                                        ))}
                                    </select>
                                    <div className="mt-4">
                                        <label className="block font-semibold mb-2">Horas</label>
                                        <div className="flex items-center gap-3">
                                            <button onClick={() => setHoras(Math.max(0, horas - 0.5))} className="bg-red-500 text-white w-12 h-12 rounded-lg hover:bg-red-600 text-2xl">‚àí</button>
                                            <div className="flex-1 text-center">
                                                <span className="text-4xl font-bold">{horas.toFixed(1)}</span>
                                                <p className="text-gray-500 text-sm">horas</p>
                                            </div>
                                            <button onClick={() => setHoras(horas + 0.5)} className="bg-green-500 text-white w-12 h-12 rounded-lg hover:bg-green-600 text-2xl">+</button>
                                        </div>
                                    </div>
                                    <div className="mt-4">
                                        <label className="block font-semibold mb-2">Cursos B√≠blicos</label>
                                        <input type="number" value={cursos} onChange={(e) => setCursos(e.target.value)} className="w-full p-3 border rounded-lg" placeholder="0" />
                                    </div>
                                    <button onClick={guardar} className="w-full mt-4 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-semibold">üíæ Guardar Informe</button>
                                </div>
                                <div className="bg-gradient-to-r from-green-500 to-green-600 rounded-lg p-6 text-white shadow-md">
                                    <div className="flex justify-between items-center mb-4">
                                        <h3 className="text-xl font-bold">Metas</h3>
                                        <button onClick={() => { if (editMetas) saveMetas(tempAnual, tempMensual); setEditMetas(!editMetas); }} className="bg-white text-green-600 px-4 py-2 rounded-lg font-semibold">
                                            {editMetas ? 'Guardar' : 'Editar'}
                                        </button>
                                    </div>
                                    {editMetas ? (
                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-green-100 mb-1">Meta Anual (Sep-Ago)</label>
                                                <input type="number" value={tempAnual} onChange={(e) => setTempAnual(parseFloat(e.target.value) || 0)} className="w-full p-2 rounded text-gray-800" />
                                            </div>
                                            <div>
                                                <label className="block text-green-100 mb-1">Meta Mensual</label>
                                                <input type="number" value={tempMensual} onChange={(e) => setTempMensual(parseFloat(e.target.value) || 0)} className="w-full p-2 rounded text-gray-800" />
                                            </div>
                                        </div>
                                    ) : (
                                        <div className="space-y-4">
                                            <div>
                                                <p className="text-green-100 mb-1">A√±o de Servicio (Sep-Ago)</p>
                                                <p className="text-3xl font-bold">{horasAnio.toFixed(1)} / {metaAnual} hrs</p>
                                                <p className="text-green-100 mt-1">Restantes: {(metaAnual - horasAnio).toFixed(1)} hrs</p>
                                                <div className="w-full bg-green-700 rounded-full h-2 mt-2">
                                                    <div className="bg-white h-2 rounded-full" style={{ width: `${Math.min((horasAnio / metaAnual) * 100, 100)}%` }}></div>
                                                </div>
                                            </div>
                                            <div>
                                                <p className="text-green-100 mb-1">Este Mes</p>
                                                <p className="text-3xl font-bold">{horasMes.toFixed(1)} / {metaMensual} hrs</p>
                                                <p className="text-green-100 mt-1">Restantes: {(metaMensual - horasMes).toFixed(1)} hrs</p>
                                                <div className="w-full bg-green-700 rounded-full h-2 mt-2">
                                                    <div className="bg-white h-2 rounded-full" style={{ width: `${Math.min((horasMes / metaMensual) * 100, 100)}%` }}></div>
                                                </div>
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </>
                        )}
                    </div>
                );
            };

            const AgendaSemanal = ({ salidas, saveSalidas }) => {
                const [editando, setEditando] = useState(null);
                const [turno, setTurno] = useState(null);
                const [form, setForm] = useState({ fecha: '', turno: 'ma√±ana', hora: '', lugar: '', conductor: '', mapa: '' });
                const semana = (() => {
                    const hoy = new Date();
                    const dia = hoy.getDay();
                    const dif = (dia + 4) % 7;
                    const mier = new Date(hoy);
                    mier.setDate(hoy.getDate() - dif);
                    return Array.from({ length: 7 }, (_, i) => {
                        const d = new Date(mier);
                        d.setDate(mier.getDate() + i);
                        return d;
                    });
                })();
                const guardar = () => {
                    if (!form.fecha) return;
                    const nuevo = salidas.filter(s => !(s.fecha === form.fecha && s.turno === form.turno));
                    if (form.hora || form.lugar || form.conductor || form.mapa) nuevo.push({ ...form });
                    saveSalidas(nuevo);
                    setEditando(null);
                    setTurno(null);
                };
                const editar = (fecha, t) => {
                    const fs = fecha.toISOString().split('T')[0];
                    const sal = salidas.find(s => s.fecha === fs && s.turno === t);
                    setForm(sal || { fecha: fs, turno: t, hora: '', lugar: '', conductor: '', mapa: '' });
                    setEditando(fs);
                    setTurno(t);
                };
                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold mb-6">üöó Salidas Semanales</h2>
                        <div className="space-y-4">
                            {semana.map((f, i) => {
                                const fs = f.toISOString().split('T')[0];
                                const sm = salidas.find(s => s.fecha === fs && s.turno === 'ma√±ana');
                                const st = salidas.find(s => s.fecha === fs && s.turno === 'tarde');
                                const esHoy = f.toDateString() === new Date().toDateString();
                                return (
                                    <div key={i} className={`bg-white rounded-lg p-4 shadow-md ${esHoy ? 'border-2 border-blue-500' : ''}`}>
                                        <h3 className="font-bold mb-3 text-lg">{f.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}{esHoy && <span className="ml-2 text-blue-500 text-sm">(Hoy)</span>}</h3>
                                        <div className="mb-3 bg-yellow-50 rounded-lg p-3">
                                            <div className="flex justify-between items-center mb-2">
                                                <div className="flex items-center"><span className="mr-2 text-xl">‚òÄÔ∏è</span><span className="font-semibold">Ma√±ana</span></div>
                                                <button onClick={() => editar(f, 'ma√±ana')} className="text-blue-500 text-xl">‚úèÔ∏è</button>
                                            </div>
                                            {editando === fs && turno === 'ma√±ana' ? (
                                                <div className="space-y-2">
                                                    <input type="time" value={form.hora} onChange={(e) => setForm({ ...form, hora: e.target.value })} className="w-full p-2 border rounded" />
                                                    <input type="text" value={form.lugar} onChange={(e) => setForm({ ...form, lugar: e.target.value })} className="w-full p-2 border rounded" placeholder="Lugar" />
                                                    <input type="text" value={form.conductor} onChange={(e) => setForm({ ...form, conductor: e.target.value })} className="w-full p-2 border rounded" placeholder="Conductor" />
                                                    <input type="text" value={form.mapa} onChange={(e) => setForm({ ...form, mapa: e.target.value })} className="w-full p-2 border rounded" placeholder="Mapa" />
                                                    <div className="flex gap-2">
                                                        <button onClick={guardar} className="flex-1 bg-green-500 text-white py-2 rounded">Guardar</button>
                                                        <button onClick={() => { setEditando(null); setTurno(null); }} className="flex-1 bg-gray-300 py-2 rounded">Cancelar</button>
                                                    </div>
                                                </div>
                                            ) : sm ? (<div className="text-sm space-y-1"><p>‚è∞ {sm.hora}</p><p>üìç {sm.lugar}</p><p>üë§ {sm.conductor}</p><p>üìñ Mapa {sm.mapa}</p></div>) : (<p className="text-gray-400 text-sm">Sin programar</p>)}
                                        </div>
                                        <div className="bg-blue-50 rounded-lg p-3">
                                            <div className="flex justify-between items-center mb-2">
                                                <div className="flex items-center"><span className="mr-2 text-xl">üåô</span><span className="font-semibold">Tarde</span></div>
                                                <button onClick={() => editar(f, 'tarde')} className="text-blue-500 text-xl">‚úèÔ∏è</button>
                                            </div>
                                            {editando === fs && turno === 'tarde' ? (
                                                <div className="space-y-2">
                                                    <input type="time" value={form.hora} onChange={(e) => setForm({ ...form, hora: e.target.value })} className="w-full p-2 border rounded" />
                                                    <input type="text" value={form.lugar} onChange={(e) => setForm({ ...form, lugar: e.target.value })} className="w-full p-2 border rounded" placeholder="Lugar" />
                                                    <input type="text" value={form.conductor} onChange={(e) => setForm({ ...form, conductor: e.target.value })} className="w-full p-2 border rounded" placeholder="Conductor" />
                                                    <input type="text" value={form.mapa} onChange={(e) => setForm({ ...form, mapa: e.target.value })} className="w-full p-2 border rounded" placeholder="Mapa" />
                                                    <div className="flex gap-2">
                                                        <button onClick={guardar} className="flex-1 bg-green-500 text-white py-2 rounded">Guardar</button>
                                                        <button onClick={() => { setEditando(null); setTurno(null); }} className="flex-1 bg-gray-300 py-2 rounded">Cancelar</button>
                                                    </div>
                                                </div>
                                            ) : st ? (<div className="text-sm space-y-1"><p>‚è∞ {st.hora}</p><p>üìç {st.lugar}</p><p>üë§ {st.conductor}</p><p>üìñ Mapa {st.mapa}</p></div>) : (<p className="text-gray-400 text-sm">Sin programar</p>)}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                );
            };

            const AgendaActividades = ({ agenda, saveAgenda }) => {
                const [mostrar, setMostrar] = useState(false);
                const [editId, setEditId] = useState(null);
                const [form, setForm] = useState({ fecha: '', hora: '', actividad: '', notas: '' });

                const semana = (() => {
                    const hoy = new Date();
                    const dia = hoy.getDay();
                    const dif = (dia + 4) % 7;
                    const mier = new Date(hoy);
                    mier.setDate(hoy.getDate() - dif);
                    return Array.from({ length: 7 }, (_, i) => {
                        const d = new Date(mier);
                        d.setDate(mier.getDate() + i);
                        return d;
                    });
                })();

                const abrir = (act = null) => {
                    if (act) {
                        setForm(act);
                        setEditId(act.id);
                    } else {
                        setForm({ fecha: '', hora: '', actividad: '', notas: '' });
                        setEditId(null);
                    }
                    setMostrar(true);
                };

                const guardar = () => {
                    if (!form.fecha || !form.actividad) return alert('Fecha y actividad son requeridos');
                    let nuevo;
                    if (editId) {
                        nuevo = agenda.map(a => a.id === editId ? { ...form, id: editId } : a);
                    } else {
                        nuevo = [...agenda, { ...form, id: Date.now().toString() }];
                    }
                    saveAgenda(nuevo);
                    setMostrar(false);
                };

                const eliminar = (id) => {
                    if (confirm('¬øEliminar actividad?')) saveAgenda(agenda.filter(a => a.id !== id));
                };

                const actividadesPorDia = (fecha) => {
                    const fs = fecha.toISOString().split('T')[0];
                    return agenda.filter(a => a.fecha === fs).sort((a, b) => a.hora.localeCompare(b.hora));
                };

                return (
                    <div className="p-6">
                        <div className="flex justify-between items-center mb-6">
                            <h2 className="text-2xl font-bold">üìÖ Mi Agenda</h2>
                            <button onClick={() => abrir()} className="bg-orange-500 text-white p-3 rounded-full shadow-lg hover:bg-orange-600 text-2xl">
                                ‚ûï
                            </button>
                        </div>

                        {mostrar ? (
                            <div className="bg-white rounded-lg p-6 shadow-md">
                                <h3 className="text-xl font-bold mb-4">{editId ? 'Editar' : 'Nueva'} Actividad</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block font-semibold mb-2">Fecha *</label>
                                        <input type="date" value={form.fecha} onChange={(e) => setForm({ ...form, fecha: e.target.value })} className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Hora</label>
                                        <input type="time" value={form.hora} onChange={(e) => setForm({ ...form, hora: e.target.value })} className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Actividad *</label>
                                        <input type="text" value={form.actividad} onChange={(e) => setForm({ ...form, actividad: e.target.value })} className="w-full p-3 border rounded-lg" placeholder="Ej: Visitar a Juan, Estudio b√≠blico..." />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Notas</label>
                                        <textarea value={form.notas} onChange={(e) => setForm({ ...form, notas: e.target.value })} className="w-full p-3 border rounded-lg" rows="3" placeholder="Detalles adicionales..."></textarea>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={guardar} className="flex-1 bg-orange-500 text-white py-3 rounded-lg hover:bg-orange-600 font-semibold">üíæ Guardar</button>
                                        <button onClick={() => setMostrar(false)} className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 font-semibold">Cancelar</button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {semana.map((f, i) => {
                                    const acts = actividadesPorDia(f);
                                    const esHoy = f.toDateString() === new Date().toDateString();
                                    return (
                                        <div key={i} className={`bg-white rounded-lg p-4 shadow-md ${esHoy ? 'border-2 border-orange-500' : ''}`}>
                                            <h3 className="font-bold mb-3">{f.toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}{esHoy && <span className="ml-2 text-orange-500 text-sm">(Hoy)</span>}</h3>
                                            {acts.length === 0 ? (
                                                <p className="text-gray-400 text-sm">Sin actividades programadas</p>
                                            ) : (
                                                <div className="space-y-2">
                                                    {acts.map(a => (
                                                        <div key={a.id} className="bg-orange-50 rounded-lg p-3">
                                                            <div className="flex justify-between items-start">
                                                                <div className="flex-1">
                                                                    <p className="font-semibold text-gray-800">{a.hora && `‚è∞ ${a.hora} - `}{a.actividad}</p>
                                                                    {a.notas && <p className="text-sm text-gray-600 mt-1">{a.notas}</p>}
                                                                </div>
                                                                <div className="flex gap-2">
                                                                    <button onClick={() => abrir(a)} className="text-blue-500">‚úèÔ∏è</button>
                                                                    <button onClick={() => eliminar(a.id)} className="text-red-500">üóëÔ∏è</button>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                        )}
                    </div>
                );
            };
const Interesados = ({ interesados, saveInteresados }) => {
                const [form, setForm] = useState({ nombre: '', direccion: '', telefono: '', fecha: '', horaPreferente: '', notas: '', id: null });
                const [editando, setEditando] = useState(false);

                const guardar = () => {
                    if (!form.nombre) return alert('El nombre es requerido');
                    let nuevo;
                    if (form.id) {
                        nuevo = interesados.map(i => i.id === form.id ? form : i);
                    } else {
                        nuevo = [...interesados, { ...form, id: Date.now().toString() }];
                    }
                    saveInteresados(nuevo);
                    setForm({ nombre: '', direccion: '', telefono: '', fecha: '', horaPreferente: '', notas: '', id: null });
                    setEditando(false);
                };

                const editar = (int) => {
                    setForm(int);
                    setEditando(true);
                };

                const eliminar = (id) => {
                    if (confirm('¬øEliminar interesado?')) saveInteresados(interesados.filter(i => i.id !== id));
                };

                return (
                    <div className="p-6">
                        <h2 className="text-2xl font-bold mb-6">üë• Personas Interesadas</h2>
                        {editando ? (
                            <div className="bg-white rounded-lg p-6 shadow-md mb-6">
                                <h3 className="text-xl font-bold mb-4">{form.id ? 'Editar' : 'Nuevo'} Interesado</h3>
                                <div className="space-y-4">
                                    <div>
                                        <label className="block font-semibold mb-2">Nombre *</label>
                                        <input type="text" value={form.nombre} onChange={(e) => setForm({ ...form, nombre: e.target.value })} className="w-full p-3 border rounded-lg" placeholder="Nombre completo" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Direcci√≥n</label>
                                        <input type="text" value={form.direccion} onChange={(e) => setForm({ ...form, direccion: e.target.value })} className="w-full p-3 border rounded-lg" placeholder="Direcci√≥n completa" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Tel√©fono</label>
                                        <input type="tel" value={form.telefono} onChange={(e) => setForm({ ...form, telefono: e.target.value })} className="w-full p-3 border rounded-lg" placeholder="N√∫mero de tel√©fono" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Pr√≥xima Visita</label>
                                        <input type="date" value={form.fecha} onChange={(e) => setForm({ ...form, fecha: e.target.value })} className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Hora Preferente</label>
                                        <input type="time" value={form.horaPreferente} onChange={(e) => setForm({ ...form, horaPreferente: e.target.value })} className="w-full p-3 border rounded-lg" />
                                    </div>
                                    <div>
                                        <label className="block font-semibold mb-2">Notas</label>
                                        <textarea value={form.notas} onChange={(e) => setForm({ ...form, notas: e.target.value })} className="w-full p-3 border rounded-lg" rows="4" placeholder="Observaciones, temas de inter√©s, etc."></textarea>
                                    </div>
                                    <div className="flex gap-2">
                                        <button onClick={guardar} className="flex-1 bg-purple-500 text-white py-3 rounded-lg hover:bg-purple-600 font-semibold">üíæ Guardar</button>
                                        <button onClick={() => { setEditando(false); setForm({ nombre: '', direccion: '', telefono: '', fecha: '', horaPreferente: '', notas: '', id: null }); }} className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 font-semibold">Cancelar</button>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <button onClick={() => setEditando(true)} className="w-full bg-purple-500 text-white py-4 rounded-lg hover:bg-purple-600 mb-6 font-semibold text-lg">‚ûï Agregar Interesado</button>
                        )}
                        <div className="space-y-3">
                            {interesados.length === 0 ? (
                                <div className="bg-gray-50 rounded-lg p-8 text-center">
                                    <p className="text-gray-600">No hay interesados registrados</p>
                                </div>
                            ) : (
                                interesados.map(int => (
                                    <div key={int.id} className="bg-white rounded-lg p-5 shadow-md">
                                        <div className="flex justify-between items-start mb-3">
                                            <h3 className="font-bold text-lg text-gray-800">{int.nombre}</h3>
                                            <div className="flex gap-2">
                                                <button onClick={() => editar(int)} className="text-blue-500 text-xl">‚úèÔ∏è</button>
                                                <button onClick={() => eliminar(int.id)} className="text-red-500 text-xl">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                        {int.direccion && <p className="text-sm text-gray-600 mb-1">üìç {int.direccion}</p>}
                                        {int.telefono && <p className="text-sm text-gray-600 mb-1">üìû {int.telefono}</p>}
                                        {int.fecha && (
                                            <div className="bg-purple-50 rounded p-2 mt-2">
                                                <p className="text-sm font-semibold text-purple-700">
                                                    üìÖ Pr√≥xima visita: {new Date(int.fecha + 'T00:00:00').toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric', month: 'long' })}
                                                    {int.horaPreferente && ` - ${int.horaPreferente}`}
                                                </p>
                                            </div>
                                        )}
                                        {int.notas && (
                                            <div className="mt-2 p-2 bg-gray-50 rounded">
                                                <p className="text-sm text-gray-700">{int.notas}</p>
                                            </div>
                                        )}
                                    </div>
                                ))
                            )}
                        </div>
                    </div>
                );
            };

     const Territorio = ({ territorio, saveTerritorio }) => {
    const [edit, setEdit] = useState(false);
    const [temp, setTemp] = useState(territorio ? JSON.parse(territorio) : { texto: '', foto: null });

    useEffect(() => {
        if (territorio) {
            try {
                const parsed = JSON.parse(territorio);
                setTemp(parsed);
            } catch {
                setTemp({ texto: territorio, foto: null });
            }
        }
    }, [territorio]);

    const handleFoto = (e) => {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (ev) => {
                setTemp({ ...temp, foto: ev.target.result });
            };
            reader.readAsDataURL(file);
        }
    };

    const guardar = () => {
        saveTerritorio(JSON.stringify(temp));
        setEdit(false);
    };

    return (
        <div className="p-6">
            <h2 className="text-2xl font-bold mb-6">üó∫Ô∏è Mi Territorio</h2>
            <div className="bg-white rounded-lg p-6 shadow-md">
                {edit ? (
                    <div className="space-y-4">
                        <div>
                            <label className="block font-semibold mb-2">Descripci√≥n del Territorio</label>
                            <textarea 
                                value={temp.texto} 
                                onChange={(e) => setTemp({ ...temp, texto: e.target.value })} 
                                className="w-full p-3 border rounded-lg" 
                                rows="8" 
                                placeholder="Describe tu territorio, calles, l√≠mites, notas importantes..."
                            ></textarea>
                        </div>
                        <div>
                            <label className="block font-semibold mb-2">Foto del Mapa üì∑</label>
                            {temp.foto && (
                                <div className="mb-3">
                                    <img src={temp.foto} alt="Mapa" className="w-full rounded-lg border" />
                                </div>
                            )}
                            <input type="file" accept="image/*" onChange={handleFoto} className="hidden" id="foto-territorio" />
                            <label htmlFor="foto-territorio" className="block w-full p-3 border-2 border-dashed rounded-lg text-center cursor-pointer hover:bg-gray-50">
                                {temp.foto ? 'üîÑ Cambiar Foto' : 'üì∑ Subir Foto del Mapa'}
                            </label>
                        </div>
                        <div className="flex gap-2">
                            <button onClick={guardar} className="flex-1 bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-semibold">üíæ Guardar</button>
                            <button onClick={() => { setEdit(false); setTemp(territorio ? JSON.parse(territorio) : { texto: '', foto: null }); }} className="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 font-semibold">Cancelar</button>
                        </div>
                    </div>
                ) : (
                    <div>
                        {temp.texto || temp.foto ? (
                            <div>
                                {temp.foto && (
                                    <div className="mb-4">
                                        <img src={temp.foto} alt="Mapa del territorio" className="w-full rounded-lg border shadow-sm" />
                                    </div>
                                )}
                                {temp.texto && (
                                    <div className="whitespace-pre-wrap text-gray-700 mb-4">{temp.texto}</div>
                                )}
                            </div>
                        ) : (
                            <div className="text-center py-8">
                                <p className="text-gray-400 mb-4">No has registrado informaci√≥n de tu territorio</p>
                            </div>
                        )}
                        <button onClick={() => setEdit(true)} className="w-full bg-blue-500 text-white py-3 rounded-lg hover:bg-blue-600 font-semibold">
                            ‚úèÔ∏è {temp.texto || temp.foto ? 'Editar' : 'Agregar'} Territorio
                        </button>
                    </div>
                )}
            </div>
        </div>
    );
};
                        <main>
                            {tab === 'inicio' && <Inicio nombre={nombre} foto={foto} salidas={salidas} informes={informes} interesados={interesados} metaMensual={metaMensual} setTab={setTab} editPerfil={editPerfil} setEditPerfil={setEditPerfil} savePerfil={savePerfil} />}
                            {tab === 'registro-rapido' && <RegistroRapido informes={informes} saveInformes={saveInformes} setTab={setTab} />}
                            {tab === 'informe' && <Informe informes={informes} saveInformes={saveInformes} metaAnual={metaAnual} metaMensual={metaMensual} saveMetas={saveMetas} />}
                            {tab === 'agenda-semanal' && <AgendaSemanal salidas={salidas} saveSalidas={saveSalidas} />}
                            {tab === 'agenda-actividades' && <AgendaActividades agenda={agenda} saveAgenda={saveAgenda} />}
                            {tab === 'interesados' && <Interesados interesados={interesados} saveInteresados={saveInteresados} />}
                            {tab === 'territorio' && <Territorio territorio={territorio} saveTerritorio={saveTerritorio} />}
                        </main>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>   

